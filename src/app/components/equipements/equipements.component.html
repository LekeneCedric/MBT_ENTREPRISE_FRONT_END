<div class="col-xl-12">
  <div class="card">
    <div class="card-header pb-0 pd-t-25">
      <div class="d-flex justify-content-between">
        <div class="d-flex justify-content-between mb-5">
          <h1 class="card-title mg-b-0">EQUIPEMENTS</h1>
        </div>
        <div class="col-sm-5 col-md-2 mg-t-10 mg-sm-t-0">
          <button
            class="btn btn-primary btn-with-icon btn-block"
            data-target="#addEquipement"
            data-toggle="modal"
            data-placement="bottom" title="Ajouter un nouvel equipement"
            (click)="cleanNew()" *ngIf="hasprivilege('add_equipement')"
          >
            <i class="typcn typcn-plus"></i>
          </button>
        </div>
      </div>

      <div class="d-flex justify-content-between mb-3">
        <div class="col-lg-6 mg-t-20 mg-lg-t-0">
          <select
            class="form-select"
            aria-label="Default select example"
            [(ngModel)]="selectedCategorie"
            (ngModelChange)="filterEquipementByCategorie()"
            data-placement="bottom" title="Filtrer equipement par categorie"
          >
            <option selected value="">Toutes les categories</option>
            <option
              *ngFor="let categorie of categories_list"
              value="{{ categorie.intitule }}"
            >
              {{ categorie.intitule }}
            </option>
          </select>
        </div>
        <div class="col-lg-6 mg-t-20 mg-lg-t-0">
          <div class="input-group" data-placement="bottom" title="Rechercher equipement ">
            <input
              class="form-control"
              placeholder="Recherchez par nom ou categorie "
              type="text"
              [(ngModel)]="searchEquipement"
              (ngModelChange)="filterEquipement()"
            />
            <span class="input-group-btn"
              ><button class="btn btn-light" type="button">
                <span class="input-group-btn"
                  ><i class="fa fa-search"></i
                ></span></button
            ></span>
          </div>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-bordered text-nowrap">
          <thead style="text-align: center">
            <tr>
              <th class="wd-15p border-bottom-0">Nom</th>
              <th class="wd-15p border-bottom-0">Equipement parent</th>
              <th class="wd-15p border-bottom-0">Categorie</th>
              <th class="wd-15p border-bottom-0">Periodicite Verif</th>
              <th class="wd-15p border-bottom-0">designation</th>
              <th class="wd-15p border-bottom-0">specialiste</th>
              <th class="wd-15p border-bottom-0">Actions</th>
            </tr>
          </thead>
          <tbody style="text-align: center">
            <tr *ngFor="let equipement of equipements_list">
              <td>{{ equipement.element }}</td>
              <td>
                {{
                  equipement.parent?.element != null
                    ? equipement.parent?.element
                    : ""
                }}
              </td>
              <td>{{ equipement.categorie?.intitule }}</td>
              <td>{{ equipement.periodicite }}</td>
              <td>{{ equipement.designation }}</td>
              <td>{{ equipement.specialite }}</td>
              <td>
                <div class="btn-icon-list mx-5">
                  <button
                    class="btn btn-warning btn-icon"
                    (click)="selectEdit(equipement)"
                    data-target="#addEquipement" *ngIf="hasprivilege('update_equipement')"
                    data-toggle="modal"
                    data-placement="bottom" title="Modifier l'equipement {{ equipement.element }}"
                  >
                    <i class="typcn typcn-brush"></i>
                  </button>
                  <button
                    class="btn btn-danger btn-icon"
                    (click)="select(equipement)" *ngIf="hasprivilege('delete_equipement')"
                    data-target="#deleteEquipement"
                    data-toggle="modal"
                    data-placement="bottom" title="Supprimer l'equipement {{ equipement.element }}"
                  >
                    <i class="typcn typcn-trash"></i>
                  </button>
                  <button
                    class="btn btn-primary btn-icon"
                    (click)="select(equipement)"
                    data-placement="bottom" title="Consulter details de l'equipement {{ equipement.element }}"
                  >
                    <i
                      class="typcn typcn-clipboard"
                      data-target="#detailEquipement"
                      data-toggle="modal"
                    ></i>
                  </button>
                  <button
                    class="btn btn-primary btn-icon"
                    routerLink="/equipements/sub/{{ equipement.id }}"
                    data-placement="bottom" title="Consulter les sous-equipements de l'equipement {{ equipement.element }}"
                  >
                    <i class="typcn typcn-flow-merge"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- bd -->
    </div>
    <!-- bd -->
  </div>
  <!-- bd -->
</div>

<!-- MODALS  -->

<!-- Delete Equipement -->
<div class="modal" id="deleteEquipement">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content tx-size-sm">
      <div class="modal-body tx-center pd-y-20 pd-x-20">
        <button
          aria-label="Close"
          class="close"
          data-dismiss="modal"
          type="button"
        >
          <span aria-hidden="true">&times;</span>
        </button>
        <i
          class="icon icon ion-ios-close-circle-outline tx-100 tx-danger lh-1 mg-t-20 d-inline-block"
        ></i>
        <h4 class="tx-danger mg-b-20">Information</h4>
        <p class="mg-b-20 mg-x-20">Voulez vous vraiment supprimer cet élément?</p>
        <div style="display: flex; justify-content: space-between">
          <button
            aria-label="Close"
            class="btn ripple btn-light pd-x-25"
            data-dismiss="modal"
            type="button"
          >
            Annuler
          </button>
          <button
            aria-label="Close"
            class="btn ripple btn-danger pd-x-25"
            (click)="removeEquipement()"
            data-dismiss="modal"
            type="button"
          >
            Supprimer
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal Add Equipements -->
<div class="modal" id="addEquipement">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content modal-content-demo">
      <div class="modal-header">
        <h6 class="modal-title" style="font-weight: bolder" *ngIf="createEq">
          Ajouter un equipement
        </h6>
        <h6 class="modal-title" style="font-weight: bolder" *ngIf="updateEq">
          Modifier un equipement
        </h6>
        <button
          aria-label="Close"
          class="close"
          data-dismiss="modal"
          type="button"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-lg-6">
            <label for="parent" class="form-label" >Equipement parent<span style="color: red">*</span></label >
            <select class="form-select"  id="categorie" [(ngModel)]="new_equipement.id_parent" (change)="selectWithId($event)" >
              <option value="0">aucun</option>
              <option  *ngFor="let equipement of equipements_parents_list" value="{{ equipement.id }}">
                {{ equipement.element }}
              </option>
            </select>
          </div>
          <div class="col-lg-6">
            <label for="nom" class="form-label"
              >Nom<span style="color: red">*</span></label
            >
            <input
              id="nom"
              class="form-control"
              placeholder="Nom de l'equipement"
              type="text"
              [(ngModel)]="new_equipement.element"
            />
          </div>
          <div class="col-lg-6 mt-3">
            <label for="categorie" class="form-label"
              >Categorie<span style="color: red">*</span></label
            >
            <select
              class="form-select"
              id="categorie"
              [(ngModel)]="new_equipement.idcategorie"
            >
              <option>Choisir la categorie</option>
              <option
                *ngFor="let categorie of categories_list"
                [style]="'color:'+(categorie.idparent == 0 ? 'red' : 'black')"
                value="{{ categorie.id }}"
              >
                {{ categorie.intitule }}
              </option>
            </select>
          </div>
          <div class="col-lg-6 mt-3">
            <label for="categorie" class="form-label"
              >Periodicite d'entretien<span style="color: red">*</span>
              (chaque)</label
            >
            <div class="row row-sm mg-b-20">
              <div class="col-lg-6">
                <input
                  id="nom"
                  class="form-control"
                  placeholder="Nombre jours"
                  type="text"
                  [(ngModel)]="new_eq_p_day"
                />
              </div>
              <!-- col-4 -->
              <div class="col-lg-6">
                <select class="form-select" [(ngModel)]="new_eq_p_periodicite">
                  <option value="day">Jours</option>
                  <option value="month">Mois</option>
                  <option value="year">Ans</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-6 mt-3">
            <label for="designation" class="form-label">Designation</label>
            <input
              id="designation"
              class="form-control"
              placeholder="Designation de l'equipement"
              type="text"
              [(ngModel)]="new_equipement.designation"
            />
          </div>
          <div class="col-lg-6 mt-3">
            <label for="specialite" class="form-label"
              >specialiste charge de la maintenance<span style="color: red"
                >*</span
              ></label
            >
            <!-- <p style="color: rgb(142, 142, 142)">
              Lors de la maintenance quel type de maintenancier prendra en
              charge l'equipement
            </p> -->
            <select
              class="form-select"
              id="specialite"
              [(ngModel)]="new_equipement.specialite"
            >
              <option value="operateurs">Operateurs</option>
              <option value="Technicien de Maintenance">
                Technicien de Maintenance
              </option>
              <option value="Technicien informatique">
                Technicien informatique
              </option>
              <option value="Technicien de surface">
                Technicien de surface
              </option>
              <option value="Plombier">Plombier</option>
              <option value="architecte">Architecte</option>
            </select>
          </div>
        </div>
        <div class="col-lg mt-3">
          <label for="categorie" class="form-label"
            >Applique la periodicite a tous les equipements enfants ?
            <span style="color: red">*</span></label>
          <div class="row mg-t-10">
            <div class="col-lg-3 mg-t-20 mg-lg-t-0">
              <label class="rdiobox"
                ><input
                  (change)="check()"
                  name="rdio"
                  type="radio"
                  value="true"
                  [(ngModel)]="new_equipement.period_is_for_child"
                />
                <span>Oui</span></label
              >
            </div>
            <div class="col-lg-3 mg-t-20 mg-lg-t-0">
              <label class="rdiobox"
                ><input
                (change)="check()"
                  name="rdio"
                  type="radio"
                  value="false"
                  [(ngModel)]="new_equipement.period_is_for_child"
                />
                <span>Non</span></label
              >
            </div>
          </div>
        </div>
        <div class="col-lg mt-3">
          <label for="categorie" class="form-label"
            >Joindre des images</label>
            <input type="file" multiple name="media[]" [(ngModel)]="media" class="form-control" accept="image/*" (change)="getfichiers($event)"/>
        </div>
        <div class="col-lg">
          <label for="description" class="form-label">description</label>
          <textarea
            id="description"
            class="form-control"
            placeholder="description de l'equipement"
            rows="5"
            [(ngModel)]="new_equipement.description"
          ></textarea>
        </div>
      </div>

        <div class="modal-footer">
          <button
            *ngIf="updateEq"
            class="btn ripple btn-warning"
            (click)="editEquipement()"
            data-dismiss="modal"
            type="button"
          >
            Modifier
          </button>
          <button
            *ngIf="createEq"
            class="btn ripple btn-primary"
            (click)="addEquipement()"
            data-dismiss="modal"
            type="button"
          >
            Enregistrer
          </button>
          <button
            class="btn ripple btn-secondary"
            data-dismiss="modal"
            type="button"
          >
            Annuler
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Detail Equipement -->
  <div class="modal" id="detailEquipement">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 900px;" role="document">
      <div class="modal-content tx-size-sm">
        <div class="modal-body tx-center pd-y-20 pd-x-20">
          <!-- <button aria-label="Close" class="close" data-dismiss="modal" type="button"><span aria-hidden="true">&times;</span></button> <i class="icon icon ion-ios-close-circle-outline tx-100 tx-primary lh-1 mg-t-20 d-inline-block"></i> -->
          <h4 class="tx-primary mg-b-20">
            Details de l'equipement
            <span style="font-weight: bolder">{{
              selectEquipement?.element
            }}</span>
          </h4>
          <p class="mg-b-20 mg-x-20" style="text-align: left" *ngIf="selectEquipement?.parent?.element">
            Equipement parent : <b>{{selectEquipement?.parent?.element != null ? selectEquipement?.parent?.element : ""}}</b>
          </p>
          <p class="mg-b-20 mg-x-20" style="text-align: left">
            Catégorie : <b>{{selectEquipement?.categorie?.intitule}}</b>
          </p>
          <p class="mg-b-20 mg-x-20" style="text-align: left">
            Designation : <b>{{selectEquipement?.designation}}</b>
          </p>
          <p class="mg-b-20 mg-x-20" style="text-align: left">
            specialiste : <b>{{selectEquipement?.specialite}}</b>
          </p>
          <p class="mg-b-20 mg-x-20" style="text-align: left" *ngIf="selectEquipement?.description">
            <b>Description</b>
          </p>
          <p class="mg-b-20 mg-x-20" style="text-align: left">
            {{ selectEquipement?.description }}
          </p>
          <p class="mg-b-20 mg-x-20" style="text-align: left" *ngIf="selectEquipement?.media">
            <b>Media</b>
          </p>
          <div class="row">
            <div class="col-lg-4" *ngFor="let item of selectEquipement?.media">
              <div style="height: 300px; display: flex; justify-content: center; align-items: center;">
                <img [src]="lienimg+'equipement/'+item?.media" style="max-width:100%;max-height: 300px;"/>
              </div>
              <button class="btn btn-danger" style="margin-top: 6px;" (click)="supprimerelt(item?.id,selectEquipement?.id)">Supprimer</button>
            </div>
          </div>
          <div style="display: flex;justify-content: flex-end;align-items: center;margin-top:20px">
            <button
              aria-label="Close"
              class="btn ripple btn-primary pd-x-25"
              data-dismiss="modal"
              type="button"
            >
              Fermer
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
